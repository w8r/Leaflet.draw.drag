"use strict";L.Path.include({transform:function(t){if(this._renderer){if(t){this._renderer.transformPath(this,t)}else{this._renderer._resetTransformPath(this);this._update()}}return this},_onMouseClick:function(t){if(this.dragging&&this.dragging.moved()||this._map.dragging&&this._map.dragging.moved()){return}this._fireMouseEvent(t)}});"use strict";L.Handler.PathDrag=L.Handler.extend({initialize:function(t){this._path=t;this._matrix=null;this._startPoint=null;this._dragStartPoint=null;this._mapDraggingWasEnabled=false},addHooks:function(){this._path.on("mousedown",this._onDragStart,this);if(this._path._path){L.DomUtil.addClass(this._path._path,"leaflet-path-draggable")}},removeHooks:function(){this._path.off("mousedown",this._onDragStart,this);if(this._path._path){L.DomUtil.removeClass(this._path._path,"leaflet-path-draggable")}},moved:function(){return this._path._dragMoved},_onDragStart:function(t){var e=t.originalEvent._simulated?"touchstart":t.originalEvent.type;this._mapDraggingWasEnabled=false;this._startPoint=t.containerPoint.clone();this._dragStartPoint=t.containerPoint.clone();this._matrix=[1,0,0,1,0,0];L.DomEvent.stop(t.originalEvent);L.DomUtil.addClass(this._path._renderer._container,"leaflet-interactive");L.DomEvent.on(document,L.Draggable.MOVE[e],this._onDrag,this).on(document,L.Draggable.END[e],this._onDragEnd,this);if(this._path._map.dragging.enabled()){this._path._map.dragging._draggable._onUp();this._path._map.dragging.disable();this._mapDraggingWasEnabled=true}this._path._dragMoved=false;if(this._path._popup){this._path._popup._close()}},_onDrag:function(t){L.DomEvent.stop(t);var e=t.touches&&t.touches.length>=1?t.touches[0]:t;var a=this._path._map.mouseEventToContainerPoint(e);var i=a.x;var r=a.y;var s=i-this._startPoint.x;var n=r-this._startPoint.y;if(!this._path._dragMoved&&(s||n)){this._path._dragMoved=true;this._path.fire("dragstart",t);this._path.bringToFront()}this._matrix[4]+=s;this._matrix[5]+=n;this._startPoint.x=i;this._startPoint.y=r;this._path.fire("predrag",t);this._path.transform(this._matrix);this._path.fire("drag",t)},_onDragEnd:function(t){var e=t.type;var a=this._path._map.mouseEventToContainerPoint(t);if(this.moved()){this._transformPoints(this._matrix);this._path._project();this._path.transform(null)}L.DomEvent.off(document,"mousemove touchmove",this._onDrag,this).off(document,"mouseup touchend",this._onDragEnd,this);this._path.fire("dragend",{distance:Math.sqrt(L.LineUtil._sqDist(this._dragStartPoint,a))});this._matrix=null;this._startPoint=null;this._dragStartPoint=null;if(this._mapDraggingWasEnabled){this._path._map.dragging.enable()}},_transformPoints:function(t){var e=this._path;var a,i,r;var s=L.point(t[4],t[5]);var n=e._map.options.crs;var o=n.transformation;var h=n.scale(e._map.getZoom());var _=n.projection;var d=o.untransform(s,h).subtract(o.untransform(L.point(0,0),h));e._bounds=new L.LatLngBounds;if(e._point){e._latlng=_.unproject(_.project(e._latlng)._add(d));e._point._add(s)}else if(e._rings||e._parts){var g=e._rings||e._parts;var p=e._latlngs;if(!L.Util.isArray(p[0])){p=[p]}for(a=0,i=g.length;a<i;a++){for(var l=0,u=g[a].length;l<u;l++){r=p[a][l];p[a][l]=_.unproject(_.project(r)._add(d));e._bounds.extend(p[a][l]);g[a][l]._add(s)}}}e._updatePath()}});L.Path.addInitHook(function(){if(this.options.draggable){if(this.dragging){this.dragging.enable()}else{this.dragging=new L.Handler.PathDrag(this);this.dragging.enable()}}else if(this.dragging){this.dragging.disable()}});L.SVG.include({_resetTransformPath:function(t){t._path.setAttributeNS(null,"transform","")},transformPath:function(t,e){t._path.setAttributeNS(null,"transform","matrix("+e.join(" ")+")")}});L.SVG.include(!L.Browser.vml?{}:{_resetTransformPath:function(t){if(t._skew){t._skew.on=false;t._path.removeChild(t._skew);t._skew=null}},transformPath:function(t,e){var a=t._skew;if(!a){a=L.SVG.create("skew");t._path.appendChild(a);a.style.behavior="url(#default#VML)";t._skew=a}var i=e[0].toFixed(8)+" "+e[1].toFixed(8)+" "+e[2].toFixed(8)+" "+e[3].toFixed(8)+" 0 0";var r=Math.floor(e[4]).toFixed()+", "+Math.floor(e[5]).toFixed()+"";var s=this._path.style;var n=parseFloat(s.left);var o=parseFloat(s.top);var h=parseFloat(s.width);var _=parseFloat(s.height);if(isNaN(n))n=0;if(isNaN(o))o=0;if(isNaN(h)||!h)h=1;if(isNaN(_)||!_)_=1;var d=(-n/h-.5).toFixed(8)+" "+(-o/_-.5).toFixed(8);a.on="f";a.matrix=i;a.origin=d;a.offset=r;a.on=true}});L.Util.trueFn=function(){return true};L.Canvas.include({_resetTransformPath:function(t){if(!this._containerCopy){return}delete this._containerCopy;if(t._containsPoint_){t._containsPoint=t._containsPoint_;delete t._containsPoint_;this._requestRedraw(t);this._draw(true)}},transformPath:function(t,e){var a=this._containerCopy;var i=this._ctx;var r=L.Browser.retina?2:1;var s=this._bounds;var n=s.getSize();var o=L.DomUtil.getPosition(this._container);if(!a){a=this._containerCopy=document.createElement("canvas");document.body.appendChild(a);a.width=r*n.x;a.height=r*n.y;t._removed=true;this._redraw();a.getContext("2d").translate(r*s.min.x,r*s.min.y);a.getContext("2d").drawImage(this._container,0,0);this._initPath(t);t._containsPoint_=t._containsPoint;t._containsPoint=L.Util.trueFn}i.save();i.setTransform(1,0,0,1,0,0);i.clearRect(o.x,o.y,n.x*r,n.y*r);i.restore();i.save();i.drawImage(this._containerCopy,0,0,n.x,n.y);i.transform.apply(i,e);var h=this._layers;this._layers={};this._initPath(t);t._updatePath();this._layers=h;i.restore()}});L.Edit.Circle.include({addHooks:function(){if(this._shape._map){this._map=this._shape._map;if(!this._markerGroup){this._enableDragging();this._initMarkers()}this._shape._map.addLayer(this._markerGroup)}},removeHooks:function(){if(this._shape._map){for(var t=0,e=this._resizeMarkers.length;t<e;t++){this._unbindMarker(this._resizeMarkers[t])}this._disableDragging();this._resizeMarkers=null;this._map.removeLayer(this._markerGroup);delete this._markerGroup}this._map=null},_createMoveMarker:L.Edit.SimpleShape.prototype._createMoveMarker,_resize:function(t){var e=this._shape.getLatLng();var a=e.distanceTo(t);this._shape.setRadius(a);this._updateMoveMarker()},_enableDragging:function(){if(!this._shape.dragging){this._shape.dragging=new L.Handler.PathDrag(this._shape)}this._shape.dragging.enable();this._shape.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._shape.dragging.disable();this._shape.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(){this._shape._map.removeLayer(this._markerGroup);this._shape.fire("editstart")},_onStopDragFeature:function(){var t=this._shape.getLatLng();this._resizeMarkers[0].setLatLng(this._getResizeMarkerPoint(t));this._shape._map.addLayer(this._markerGroup);this._updateMoveMarker();this._fireEdit()}});L.Edit.Poly.include({__createMarker:L.Edit.Poly.prototype._createMarker,__removeMarker:L.Edit.Poly.prototype._removeMarker,addHooks:function(){if(this._poly._map){if(!this._markerGroup){this._enableDragging();this._initMarkers();this._createMoveMarker()}this._poly._map.addLayer(this._markerGroup)}},_createMoveMarker:function(){if(L.EditToolbar.Edit.MOVE_MARKERS&&this._poly instanceof L.Polygon){this._moveMarker=new L.Marker(this._getShapeCenter(),{icon:this.options.moveIcon});this._moveMarker.on("mousedown",this._delegateToShape,this);this._markerGroup.addLayer(this._moveMarker)}},_delegateToShape:function(t){var e=this._shape||this._poly;var a=t.target;e.fire("mousedown",L.Util.extend(t,{containerPoint:L.DomUtil.getPosition(a._icon).add(e._map._getMapPanePos())}))},_getShapeCenter:function(){return this._poly.getCenter()},removeHooks:function(){if(this._poly._map){this._poly._map.removeLayer(this._markerGroup);this._disableDragging();delete this._markerGroup;delete this._markers}},_enableDragging:function(){if(!this._poly.dragging){this._poly.dragging=new L.Handler.PathDrag(this._poly)}this._poly.dragging.enable();this._poly.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._poly.dragging.disable();this._poly.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(t){this._poly._map.removeLayer(this._markerGroup);this._poly.fire("editstart")},_onStopDragFeature:function(t){var e=this._poly;for(var a=0,i=e._latlngs.length;a<i;a++){var r=this._markers[a];r.setLatLng(e._latlngs[a]);r._origLatLng=e._latlngs[a];if(r._middleLeft){r._middleLeft.setLatLng(this._getMiddleLatLng(r._prev,r))}if(r._middleRight){r._middleRight.setLatLng(this._getMiddleLatLng(r,r._next))}}this._poly._map.addLayer(this._markerGroup);L.Edit.SimpleShape.prototype._updateMoveMarker.call(this);this._fireEdit()},_updateMoveMarker:L.Edit.SimpleShape.prototype._updateMoveMarker,_createMarker:function(t,e){var a=this.__createMarker(t,e);a.on("dragstart",this._hideMoveMarker,this).on("dragend",this._showUpdateMoveMarker,this);return a},_removeMarker:function(t){this.__removeMarker(t);t.off("dragstart",this._hideMoveMarker,this).off("dragend",this._showUpdateMoveMarker,this)},_hideMoveMarker:function(){if(this._moveMarker){this._markerGroup.removeLayer(this._moveMarker)}},_showUpdateMoveMarker:function(){if(this._moveMarker){this._markerGroup.addLayer(this._moveMarker);this._updateMoveMarker()}}});L.Edit.Poly.prototype.options.moveIcon=new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"});L.Edit.Poly.mergeOptions({moveMarker:false});L.Edit.Rectangle.include({addHooks:function(){if(this._shape._map){if(!this._markerGroup){this._enableDragging();this._initMarkers()}this._shape._map.addLayer(this._markerGroup)}},removeHooks:function(){if(this._shape._map){this._shape._map.removeLayer(this._markerGroup);this._disableDragging();delete this._markerGroup;delete this._markers}},_resize:function(t){this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner));this._updateMoveMarker()},_onMarkerDragEnd:function(t){this._toggleCornerMarkers(1);this._repositionCornerMarkers();L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_enableDragging:function(){if(!this._shape.dragging){this._shape.dragging=new L.Handler.PathDrag(this._shape)}this._shape.dragging.enable();this._shape.on("dragstart",this._onStartDragFeature,this).on("dragend",this._onStopDragFeature,this)},_disableDragging:function(){this._shape.dragging.disable();this._shape.off("dragstart",this._onStartDragFeature,this).off("dragend",this._onStopDragFeature,this)},_onStartDragFeature:function(){this._shape._map.removeLayer(this._markerGroup);this._shape.fire("editstart")},_onStopDragFeature:function(){var t=this._shape;for(var e=0,a=t._latlngs.length;e<a;e++){var i=this._resizeMarkers[e];i.setLatLng(t._latlngs[e]);i._origLatLng=t._latlngs[e];if(i._middleLeft){i._middleLeft.setLatLng(this._getMiddleLatLng(i._prev,i))}if(i._middleRight){i._middleRight.setLatLng(this._getMiddleLatLng(i,i._next))}}this._shape._map.addLayer(this._markerGroup);this._updateMoveMarker();this._repositionCornerMarkers();this._fireEdit()}});L.Edit.SimpleShape.include({_updateMoveMarker:function(){if(this._moveMarker){this._moveMarker.setLatLng(this._getShapeCenter())}},_getShapeCenter:function(){return this._shape.getBounds().getCenter()},_createMoveMarker:function(){if(L.EditToolbar.Edit.MOVE_MARKERS){this._moveMarker=this._createMarker(this._getShapeCenter(),this.options.moveIcon)}}});L.Edit.SimpleShape.mergeOptions({moveMarker:false});"use strict";L.EditToolbar.Edit.MOVE_MARKERS=false;L.EditToolbar.Edit.include({initialize:function(t,e){L.EditToolbar.Edit.MOVE_MARKERS=!!e.selectedPathOptions.moveMarkers;this._initialize(t,e)},_initialize:L.EditToolbar.Edit.prototype.initialize});L.Polygon.include({getCenter:function(){var t,e,a,i,r,s,n,o,h,_=this._parts[0];n=o=h=0;for(t=0,a=_.length,e=a-1;t<a;e=t++){i=_[t];r=_[e];s=i.y*r.x-r.y*i.x;o+=(i.x+r.x)*s;h+=(i.y+r.y)*s;n+=s*3}return this._map.layerPointToLatLng([o/n,h/n])}});